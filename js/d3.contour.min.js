// https://d3js.org/d3-contour/ Version 1.1.1. Copyright 2017 Mike Bostock.
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports,require("d3-array")):"function"==typeof define&&define.amd?define(["exports","d3-array"],r):r(t.d3=t.d3||{},t.d3)}(this,function(t,r){"use strict";function n(t,r){for(var n=r[0],i=r[1],a=-1,o=0,h=t.length,f=h-1;o<h;f=o++){var u=t[o],c=u[0],d=u[1],l=t[f],s=l[0],g=l[1];if(e(u,l,r))return 0;d>i!=g>i&&n<(s-c)*(i-d)/(g-d)+c&&(a=-a)}return a}function e(t,r,n){var e;return i(t,r,n)&&a(t[e=+(t[0]===r[0])],n[e],r[e])}function i(t,r,n){return(r[0]-t[0])*(n[1]-t[1])==(n[0]-t[0])*(r[1]-t[1])}function a(t,r,n){return t<=r&&r<=n||n<=r&&r<=t}function o(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<i;++o)for(var h=0,f=0;h<e+n;++h)h<e&&(f+=t.data[h+o*e]),h>=n&&(h>=a&&(f-=t.data[h-a+o*e]),r.data[h-n+o*e]=f/Math.min(h+1,e-1+a-h,a))}function h(t,r,n){for(var e=t.width,i=t.height,a=1+(n<<1),o=0;o<e;++o)for(var h=0,f=0;h<i+n;++h)h<i&&(f+=t.data[o+h*e]),h>=n&&(h>=a&&(f-=t.data[o+(h-a)*e]),r.data[o+(h-n)*e]=f/Math.min(h+1,i-1+a-h,a))}function f(t){return t[0]}function u(t){return t[1]}var c=Array.prototype.slice,d=function(t,r){return t-r},l=function(t){for(var r=0,n=t.length,e=t[n-1][1]*t[0][0]-t[n-1][0]*t[0][1];++r<n;)e+=t[r-1][1]*t[r][0]-t[r-1][0]*t[r][1];return e},s=function(t){return function(){return t}},g=function(t,r){for(var e,i=-1,a=r.length;++i<a;)if(e=n(t,r[i]))return e;return 0},v=function(){},w=[[],[[[1,1.5],[.5,1]]],[[[1.5,1],[1,1.5]]],[[[1.5,1],[.5,1]]],[[[1,.5],[1.5,1]]],[[[1,.5],[.5,1]],[[1,1.5],[1.5,1]]],[[[1,.5],[1,1.5]]],[[[1,.5],[.5,1]]],[[[.5,1],[1,.5]]],[[[1,1.5],[1,.5]]],[[[.5,1],[1,1.5]],[[1.5,1],[1,.5]]],[[[1.5,1],[1,.5]]],[[[.5,1],[1.5,1]]],[[[1,1.5],[1.5,1]]],[[[.5,1],[1,1.5]]],[]],p=function(){function t(t){var e=h(t);if(Array.isArray(e))e=e.slice().sort(d);else{var i=r.extent(t),a=i[0],o=i[1];e=r.tickStep(a,o,e),e=r.range(Math.floor(a/e)*e,Math.floor(o/e)*e,e)}return e.map(function(r){var e=[],i=[];return n(t,r,function(n){f(n,t,r),l(n)>0?e.push([n]):i.push(n)}),i.forEach(function(t){for(var r,n=0,i=e.length;n<i;++n)if(-1!==g((r=e[n])[0],t))return void r.push(t)}),e}).map(function(t,r){return{type:"MultiPolygon",value:e[r],coordinates:t}})}function n(t,r,n){function i(t){var r,i,a=[t[0][0]+h,t[0][1]+f],o=[t[1][0]+h,t[1][1]+f],u=e(a),c=e(o);(r=g[u])?(i=s[c])?(delete g[r.end],delete s[i.start],r===i?(r.ring.push(o),n(r.ring)):s[r.start]=g[i.end]={start:r.start,end:i.end,ring:r.ring.concat(i.ring)}):(delete g[r.end],r.ring.push(o),g[r.end=c]=r):(r=s[c])?(i=g[u])?(delete s[r.start],delete g[i.end],r===i?(r.ring.push(o),n(r.ring)):s[i.start]=g[r.end]={start:i.start,end:r.end,ring:i.ring.concat(r.ring)}):(delete s[r.start],r.ring.unshift(a),s[r.start=u]=r):s[u]=g[c]={start:u,end:c,ring:[a,o]}}var h,f,u,c,d,l,s=new Array,g=new Array;for(h=f=-1,c=t[0]>=r,w[c<<1].forEach(i);++h<a-1;)u=c,c=t[h+1]>=r,w[u|c<<1].forEach(i);for(w[c<<0].forEach(i);++f<o-1;){for(h=-1,c=t[f*a+a]>=r,d=t[f*a]>=r,w[c<<1|d<<2].forEach(i);++h<a-1;)u=c,c=t[f*a+a+h+1]>=r,l=d,d=t[f*a+h+1]>=r,w[u|c<<1|d<<2|l<<3].forEach(i);w[c|d<<3].forEach(i)}for(h=-1,d=t[f*a]>=r,w[d<<2].forEach(i);++h<a-1;)l=d,d=t[f*a+h+1]>=r,w[d<<2|l<<3].forEach(i);w[d<<3].forEach(i)}function e(t){return 2*t[0]+t[1]*(a+1)*4}function i(t,r,n){t.forEach(function(t){var e,i=t[0],h=t[1],f=0|i,u=0|h,c=r[u*a+f];i>0&&i<a&&f===i&&(e=r[u*a+f-1],t[0]=i+(n-e)/(c-e)-.5),h>0&&h<o&&u===h&&(e=r[(u-1)*a+f],t[1]=h+(n-e)/(c-e)-.5)})}var a=1,o=1,h=r.thresholdSturges,f=i;return t.size=function(r){if(!arguments.length)return[a,o];var n=Math.ceil(r[0]),e=Math.ceil(r[1]);if(!(n>0&&e>0))throw new Error("invalid size");return a=n,o=e,t},t.thresholds=function(r){return arguments.length?(h="function"==typeof r?r:s(Array.isArray(r)?c.call(r):r),t):h},t.smooth=function(r){return arguments.length?(f=r?i:v,t):f===i},t};t.contours=p,t.contourDensity=function(){function t(t){var e=new Float32Array(A*m),i=new Float32Array(A*m);t.forEach(function(t,r,n){var i=l(t,r,n)+E>>M,a=g(t,r,n)+E>>M;i>=0&&i<A&&a>=0&&a<m&&++e[i+a*A]}),o({width:A,height:m,data:e},{width:A,height:m,data:i},y>>M),h({width:A,height:m,data:i},{width:A,height:m,data:e},y>>M),o({width:A,height:m,data:e},{width:A,height:m,data:i},y>>M),h({width:A,height:m,data:i},{width:A,height:m,data:e},y>>M),o({width:A,height:m,data:e},{width:A,height:m,data:i},y>>M),h({width:A,height:m,data:i},{width:A,height:m,data:e},y>>M);var a=z(e);if(!Array.isArray(a)){var f=r.max(e);a=r.tickStep(0,f,a),(a=r.range(0,Math.floor(f/a)*a,a)).shift()}return p().thresholds(a).size([A,m])(e).map(n)}function n(t){return t.value*=Math.pow(2,-2*M),t.coordinates.forEach(e),t}function e(t){t.forEach(i)}function i(t){t.forEach(a)}function a(t){t[0]=t[0]*Math.pow(2,M)-E,t[1]=t[1]*Math.pow(2,M)-E}function d(){return E=3*y,A=v+2*E>>M,m=w+2*E>>M,t}var l=f,g=u,v=960,w=500,y=20,M=2,E=3*y,A=v+2*E>>M,m=w+2*E>>M,z=s(20);return t.x=function(r){return arguments.length?(l="function"==typeof r?r:s(+r),t):l},t.y=function(r){return arguments.length?(g="function"==typeof r?r:s(+r),t):g},t.size=function(t){if(!arguments.length)return[v,w];var r=Math.ceil(t[0]),n=Math.ceil(t[1]);if(!(r>=0||r>=0))throw new Error("invalid size");return v=r,w=n,d()},t.cellSize=function(t){if(!arguments.length)return 1<<M;if(!((t=+t)>=1))throw new Error("invalid cell size");return M=Math.floor(Math.log(t)/Math.LN2),d()},t.thresholds=function(r){return arguments.length?(z="function"==typeof r?r:s(Array.isArray(r)?c.call(r):r),t):z},t.bandwidth=function(t){if(!arguments.length)return Math.sqrt(y*(y+1));if(!((t=+t)>=0))throw new Error("invalid bandwidth");return y=Math.round((Math.sqrt(4*t*t+1)-1)/2),d()},t},Object.defineProperty(t,"__esModule",{value:!0})});